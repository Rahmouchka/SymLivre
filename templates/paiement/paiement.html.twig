{% extends 'base.html.twig' %}

{% block title %}Paiement{% endblock %}

{% block body %}
    <h1>Confirmer votre paiement</h1>
    <button id="checkout-button">Acheter</button>
{% endblock %}

{% block javascripts %}
    <script src="https://js.stripe.com/v3/"></script>
    <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            var stripe = Stripe('{{ stripe_public_key }}');

            var checkoutButton = document.getElementById('checkout-button');

            if (checkoutButton) {
                checkoutButton.addEventListener('click', function () {
                    fetch('/create-checkout-session', {
                        method: 'POST',
                    })
                        .then(function(response) {
                            return response.json();
                        })
                        .then(function(session) {
                            return stripe.redirectToCheckout({ sessionId: session.id });
                        })
                        .then(function(result) {
                            if (result.error) {
                                alert(result.error.message);
                            }
                        })
                        .catch(function(error) {
                            console.error('Error:', error);
                        });
                });
            } else {
                console.error('checkout-button introuvable dans le DOM');
            }
        });
    </script>
{% endblock %}
